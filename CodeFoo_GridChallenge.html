<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CodeFooGrid3x3 1.1</title>

<style>

	* {
		margin: 0px;
		padding: 0px;
		font-weight:bold;
		font-family:Arial;
		color: #794099;
	}
	
	body {
		background-color: #F8F8F8;
	}
	
	.container{
		padding:10px;
	}
	
	#grid-list {
		list-style:none;
	}
	
	#anwser-list {
		list-style:none;
		padding:10px;
	}
	
	#grid-h, #grid-w{
		color:black;
	}
	
	.number-box {
		margin:10px;
		text-align:center;
		height:40px;
		font-size:20px;
	}
	
	button {
		padding:16px;
	}
</style>

</head>

<body>

<div class = "container">

	<div class="container">
		Grid Size: 
		<input id="grid-w" class="number-box" size="2" maxLength="2" value='3'></input>
		x
		<input id="grid-h" class="number-box" size="2" maxLength="2" value='3'></input>
		Grid Width: 
		<input id="width-input" class="number-box" size="2" maxLength="2" value='' disabled="true"></input>
		Grid Area: 
		<input id="area-input" class="number-box" size="2" maxLength="2" value='' disabled="true"></input>
		Press Button For New Grid:
		<button id="button" type="button" onclick="createGrid()"> Randomize Grid</button>
	</div>
	<hr/>
	<div class="container" style="float:left">
		<hr/>
		<ul id="grid-list">
			
		</ul>
		<hr/>
	</div>
	
	<div class="container" style="float:left">
		
		Valid Combinations:
		
		<ul id="anwser-list">
			
		</ul>
	</div>
</div>

<script>
	//Documnet Refrences
	var ulist = document.getElementById("grid-list");
	var alist = document.getElementById("anwser-list");
	
	var width_input = document.getElementById("width-input");
	var area_input = document.getElementById("area-input");
	
	var grid_w = document.getElementById("grid-w");
	var grid_h = document.getElementById("grid-h");
	
	//Varibles
	var width = grid_w.value;
	var height = grid_h.value;
	var area = grid_w.value * grid_h.value;
	
	width_input.value = width;
	area_input.value = area;
	
	var area = width * height;
	
	var valid_list = new Array();
	
	//GRID
	grid = new Array(width);
	createGrid();
	
	//Function resets grid to w x h array filled with random numbers (0-9)
	function createGrid(){
	
		ulist.innerHTML = "";
		alist.innerHTML = "";
		
		width = grid_w.value;
		height = grid_h.value;
		area = grid_w.value * grid_h.value;
		
		width_input.value = width;
		area_input.value = area;
		
		area = width * height;
		
		grid = new Array(width);
		
		for (h=0; h < height; h++){
			col_array = [];
			for (w=0; w < width; w++){
				col_array[w] = random_number();
			}
			grid[h] = col_array;
		}
		
		for (i in grid){
			add_row(grid[i]);
		}
		
		valid_list = []; //Clears list of valid chain entries
		computeChains(); //Search for new valid chain entries
	}
	
	//Returns random number between 0 and 9
	function random_number(){
			return Math.round(Math.random() * 9);
		}
		
	//Populates Row in grid
	function add_row(item){
		var li = document.createElement("li");

		for (j in item){
			var entity = document.createElement('input'); 
			entity.className = 'number-box';
			entity.value = item[j];
			entity.size = 1;
			entity.maxLength = 1;
			entity.disabled = 'true';
			entity.style.color = 'black';
			li.appendChild(entity);
		}

		ulist.appendChild(li);
		}
	
	//Compute all the valid chains that add up to the area of the grid. Chain lenth must not repeat entries in the grid and be of length grid width.length - 1; 
	function computeChains(){	
		console.clear();
		
		for (row in grid){
			for (col in grid[row]){
					findChain(row, col, new Array());
			}
		}
		console.log(valid_list);
	}
	
	function findChain(p_row, p_col, value_array){
		
		p_row = parseInt(p_row);
		p_col = parseInt(p_col);
		
		//If index p_row, p_col is out of bounds retrun null
		if (p_row > height-1 || p_row < 0){ return;}
		if (p_col > width-1 || p_col < 0){ return;}
		if (value_array.length > area){return;}
		
		str_chain = "";
		
		var chain_total = 0;
		var p = 0;
		
		for (p in value_array){
			chain_total += value_array[p].value;
			str_chain += " + " + value_array[p].value;
			
			if (value_array[p].r == p_row && value_array[p].c == p_col){return;}
		}
		
		chain_total += grid[p_row][p_col];
		
		//If chain adds up to total print chain
		if (chain_total == area){
			value_array[value_array.length] = {value:grid[p_row][p_col], r:p_row, c:p_col};
			checkNewAnwserAndPrint(value_array);
			return;
		}
		//If chain adds up to a total greater than the area of the grid return null; 
		else if (chain_total > area){
			return;
		}
		//If current chain adds up to a total smaller than the grid area continue to search this chain. 
		else if (chain_total < area){
			value_array[value_array.length] = {value:grid[p_row][p_col], r:p_row, c:p_col};
			str_chain += " + " + grid[p_row][p_col];
			
			//Recursivly check the chain at each position surrounding the current index
			findChain(p_row-1, p_col-1, value_array.slice());
			findChain(p_row-1, p_col, value_array.slice());
			findChain(p_row-1, p_col+1, value_array.slice());
			findChain(p_row, p_col-1, value_array.slice());
			findChain(p_row, p_col+1, value_array.slice());
			findChain(p_row+1, p_col-1, value_array.slice());
			findChain(p_row+1, p_col, value_array.slice());
			findChain(p_row+1, p_col+1, value_array.slice());
		}
	}
	
	//Checks if chain already exsists in array of valid anwsers then prints awnser.
	function checkNewAnwserAndPrint(chain_array){
		
		index_array = new Array();
		for (index in chain_array){index_array[index_array.length] = chain_array[index].value;}
		
		if (index_array.length < width-1){return;}
		
		console.log(index_array);

		//If the chain_array already exsists in valid_array return null
		for (v in valid_list){
			if (sameArray(index_array, valid_list[v])){
				console.log('^^Already Exsists');
				return;
			}

		}
		
		//Add new chain to valid_array then print
		valid_list[valid_list.length] = index_array;
		
		var li = document.createElement("li");
		li.innerHTML = index_array.join(" + ") + ' = ' + area;
		li.style.color = 'black';
		alist.appendChild(li);
		
	}
	
	//Checks if both arrays conatain all the same entries 
	function sameArray(a,b){
		if (a.length != b.length){return false;}
		
		a = a.sort();
		b = b.sort();
		
		for (ii in a){
			if (a[ii] != b[ii]){
				return false;
			}
		}
		
		return true;
	}
	
	
</script>

</body>

</html>